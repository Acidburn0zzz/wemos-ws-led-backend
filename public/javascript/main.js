// How many wemos are connected. Default is 0
var wemos_count = 0;

// Global variable of the hex color. Default is 0
var hex_color = 0;




// Poll: fetching how many devices are connected from "/status"
(function poll() {
  setTimeout(function () {
    $.ajax({
      url: "/status",
      headers: {
        'Content-Type': 'application/json'
      },
      type: "GET",
      success: function (data) {

        // check if null return (no results from API)
        if (data.client_number == 0) {
        } else if (data.client_number == 1){
          $('h4').html("✅ Wemos is connected");
          $("h4").removeClass("loading");
          return wemos_count = data.client_number;
        }
        else if(data.client_number >= 2) {
          $('h4').html("✅✅✅ Woa! We have several wemos here :)");
          $("h4").removeClass("loading");
          return wemos_count = data.client_number;
        }
      },
      dataType: "json",
      complete: poll,
      timeout: 2000
    })
  }, 3000);
})();

(function () {
  var draw, h, hash, hsl, l, lock, s;

  h = ~~(Math.random() * 360);

  s = 50;

  l = 50;

  lock = false;
  var hcl, hsl, lab, rgb;
  var wemosIsOpen = false;
  draw = function () {
    if (lock === false) {
      console.log("wemosIsOpen is " + wemosIsOpen);
      $('.color div').hide();
      hsl = new d3.hsl(h, s / 100.0, l / 100.0);
      hcl = new d3.hcl(hsl);
      rgb = new d3.rgb(hsl);
      lab = new d3.lab(hsl);
      $('span').html("");
      $('span').append(`rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`);
      $('body').css("background-color", `hsl(${h}, ${s}%, ${l}%)`);
      return $('body').css("color", `rgb(${Math.min(rgb.r + 96, 255)}, ${Math.min(rgb.g + 96, 255)}, ${Math.min(rgb.b + 96, 255)})`);
    } else {
      return $('.color div').show();
    }
  };

  $(window).mousemove(function (e) {
    var maxX, maxY, x, y;
    maxX = window.innerWidth;
    maxY = window.innerHeight;
    x = e.pageX;
    y = e.pageY;
    h = ~~(x / maxX * 360);
    l = ~~(y / maxY * 10000) / 100;
    draw();
  });

  $('body').bind("mousewheel", function (e) {
    var delta;
    if (e.wheelDelta) {
      delta = e.wheelDelta / 120;
    }
    if (e.details) {
      delta = -e.details;
    }
    if (e.originalEvent.wheelDelta) {
      delta = e.originalEvent.wheelDelta / 120;
    }
    if (e.originalEvent.details) {
      delta = -e.originalEvent.details;
    }
    s = Math.max(0, Math.min(100, s + delta * 5));
    draw();
  });

  $('.color div').click(function () {
    return lock = false;
  });
  
  // HTML notification function
  function notify(quote, type) {
    var notifyElement = $("<div />").addClass(type).html(quote);
    $('.notify').prepend(notifyElement);
    setTimeout(function (ele) {
      ele.remove();
    }, 3000, notifyElement);
  }
  //Touch events manager
  document.body.addEventListener('touchstart', function (e) {
    var maxX, maxY, x, y;
    maxX = window.innerWidth;
    maxY = window.innerHeight;
    x = e.pageX;
    y = e.pageY;
    h = ~~(x / maxX * 360);
    l = ~~(y / maxY * 10000) / 100;
    draw();
    sendColor(rgb.r, rgb.g, rgb.b);
  });
  //On Click manager. Send colors to wemos if available
  $(window).click(function () {
    sendColor(rgb.r, rgb.g, rgb.b);
  });

  hash = location.hash.indexOf('(') > 0 ? location.hash.substr(1) : location.hash;

  if (hash.length > 0) {
    hsl = new d3.hsl(hash);
    h = hsl.h;
    s = hsl.s * 100;
    l = hsl.l * 100;
    draw();
    lock = true;
  } else {
    draw();
  }

}).call(this);
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiPGFub255bW91cz4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBOztFQUFBLENBQUEsR0FBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTCxDQUFBLENBQUEsR0FBZ0IsR0FBakI7O0VBQ04sQ0FBQSxHQUFJOztFQUNKLENBQUEsR0FBSTs7RUFDSixJQUFBLEdBQU87O0VBRVAsSUFBQSxHQUFPLFFBQUEsQ0FBQSxDQUFBO0FBQ0wsUUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQTtJQUFBLElBQUcsSUFBQSxLQUFRLEtBQVg7TUFDRSxDQUFBLENBQUUsR0FBRixDQUFNLENBQUMsSUFBUCxDQUFBO01BQ0EsR0FBQSxHQUFNLElBQUksRUFBRSxDQUFDLEdBQVAsQ0FBVyxDQUFYLEVBQWMsQ0FBQSxHQUFJLEtBQWxCLEVBQXlCLENBQUEsR0FBSSxLQUE3QjtNQUNOLEdBQUEsR0FBTSxJQUFJLEVBQUUsQ0FBQyxHQUFQLENBQVcsR0FBWDtNQUNOLEdBQUEsR0FBTSxJQUFJLEVBQUUsQ0FBQyxHQUFQLENBQVcsR0FBWDtNQUNOLEdBQUEsR0FBTSxJQUFJLEVBQUUsQ0FBQyxHQUFQLENBQVcsR0FBWDtNQUNOLENBQUEsQ0FBRSxNQUFGLENBQVMsQ0FBQyxJQUFWLENBQWUsRUFBZjtNQUNBLENBQUEsQ0FBRSxNQUFGLENBQVMsQ0FBQyxNQUFWLENBQWlCLEdBQUcsQ0FBQyxRQUFKLENBQUEsQ0FBakI7TUFDQSxDQUFBLENBQUUsTUFBRixDQUFTLENBQUMsTUFBVixDQUFpQixDQUFBLFdBQUEsQ0FBQSxDQUFjLEdBQUcsQ0FBQyxDQUFsQixDQUFvQixFQUFwQixDQUFBLENBQXdCLEdBQUcsQ0FBQyxDQUE1QixDQUE4QixFQUE5QixDQUFBLENBQWtDLEdBQUcsQ0FBQyxD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QUFDOztFQUNwRixJQUFHLElBQUksQ0FBQyxNQUFMLEdBQWMsQ0FBakI7SUFDRSxHQUFBLEdBQU0sSUFBSSxFQUFFLENBQUMsR0FBUCxDQUFXLElBQVg7SUFDTixDQUFBLEdBQUksR0FBRyxDQUFDO0lBQ1IsQ0FBQSxHQUFJLEdBQUcsQ0FBQyxDQUFKLEdBQVE7SUFDWixDQUFBLEdBQUksR0FBRyxDQUFDLENBQUosR0FBUTtJQUNaLElBQUEsQ0FBQTtJQUNBLElBQUEsR0FBTyxLQU5UO0dBQUEsTUFBQTtJQVFFLElBQUEsQ0FBQSxFQVJGOztBQTNEQSIsInNvdXJjZXNDb250ZW50IjpbImggPSB+fihNYXRoLnJhbmRvbSgpICogMzYwKVxucyA9IDUwXG5sID0gNTBcbmxvY2sgPSBvZmZcbiAgICBcbmRyYXcgPSAoKSAtPlxuICBpZiBsb2NrIGlzIG9mZlxuICAgICQoJ2InKS5oaWRlKClcbiAgICBoc2wgPSBuZXcgZDMuaHNsIGgsIHMgLyAxMDAuMCwgbCAvIDEwMC4wXG4gICAgaGNsID0gbmV3IGQzLmhjbCBoc2xcbiAgICByZ2IgPSBuZXcgZDMucmdiIGhzbFxuICAgIGxhYiA9IG5ldyBkMy5sYWIgaHNsXG4gICAgJCgnc3BhbicpLmh0bWwgXCJcIlxuICAgICQoJ3NwYW4nKS5hcHBlbmQgaHNsLnRvU3RyaW5nKClcbiAgICAkKCdzcGFuJykuYXBwZW5kIFwiPGJyIC8+IHJnYigje3JnYi5yfSwgI3tyZ2IuZ30sICN7cmdiLmJ9KVwiXG4gICAgJCgnc3BhbicpLmFwcGVuZCBcIjxiciAvPiBoc2woI3tofSwgI3tzfSUsICN7bH0lKVwiXG4gICAgJCgnc3BhbicpLmFwcGVuZCBcIjxiciAvPiBoY2woI3sofn5oY2wuaCArIDM2MCkgJSAzNjB9LCAje2hjbC5jLnRvRml4ZWQoMil9JSwgI3toY2wubC50b0ZpeGVkKDIpfSUpXCJcbiAgICAkKCdzcGFuJykuYXBwZW5kIFwiPGJyIC8+IGxhYigje2xhYi5sLnRvRml4ZWQoMCl9LCAje2xhYi5hLnRvRml4ZWQoMCl9LCAje2xhYi5iLnRvRml4ZWQoMCl9KVwiXG4gICAgJCgnYm9keScpLmNzcyBcImJhY2tncm91bmQtY29sb3JcIiwgXCJoc2woI3tofSwgI3tzfSUsICN7bH0lKVwiXG4gICAgJCgnYm9keScpLmNzcyBcImNvbG9yXCIsIFwicmdiKCN7TWF0aC5taW4ocmdiLnIgKyA5NiwgMjU1KX0sICN7TWF0aC5taW4ocmdiLmcgKyA5NiwgMjU1KX0sICN7TWF0aC5taW4ocmdiLmIgKyA5NiwgMjU1KX0pXCJcbiAgZWxzZVxuICAgICQoJ2InKS5zaG93KClcblxuXG4kKHdpbmRvdykubW91c2Vtb3ZlIChlKSAtPlxuICBtYXhYID0gd2luZG93LmlubmVyV2lkdGhcbiAgbWF4WSA9IHdpbmRvdy5pbm5lckhlaWdodFxuICB4ID0gZS5wYWdlWFxuICB5ID0gZS5wYWdlWVxuICBoID0gfn4oeCAvIG1heFggKiAzNjApXG4gIGwgPSB+fih5IC8gbWF4WSAqIDEwMDAwKSAvIDEwMFxuICBkcmF3KClcbiAgcmV0dXJuXG4gICAgXG4kKCdib2R5JykuYmluZCBcIm1vdXNld2hlZWxcIiwgKGUpIC0+XG4gIGRlbHRhID0gZS53aGVlbERlbHRhIC8gMTIwIGlmIGUud2hlZWxEZWx0YVxuICBkZWx0YSA9IC1lLmRldGFpbHMgaWYgZS5kZXRhaWxzXG4gIGRlbHRhID0gZS5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEgLyAxMjAgaWYgZS5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGFcbiAgZGVsdGEgPSAtZS5vcmlnaW5hbEV2ZW50LmRldGFpbHMgaWYgZS5vcmlnaW5hbEV2ZW50LmRldGFpbHNcbiAgcyA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgcyArIGRlbHRhICogNSkpXG4gIGRyYXcoKVxuICByZXR1cm5cbiAgICBcbiQoJ2InKS5jbGljayAoKSAtPlxuICBsb2NrID0gb2ZmXG5cbiQod2luZG93KS5jbGljayAoKSAtPlxuICBsb2NrID0gb25cblxuJCh3aW5kb3cpLmRibGNsaWNrICgpIC0+XG4gIGxvY2sgPSBvZmZcbiAgXG4kKCdiJykubW91c2VlbnRlciAoKSAtPlxuICAkKCdiJykuaHRtbCAn8J+UkydcblxuJCgnYicpLm1vdXNlbGVhdmUgKCkgLT5cbiAgJCgnYicpLmh0bWwgJ/CflJInXG4gICAgXG5oYXNoID0gaWYgbG9jYXRpb24uaGFzaC5pbmRleE9mKCcoJykgPiAwIHRoZW4gbG9jYXRpb24uaGFzaC5zdWJzdHIoMSkgZWxzZSBsb2NhdGlvbi5oYXNoXG5pZiBoYXNoLmxlbmd0aCA+IDBcbiAgaHNsID0gbmV3IGQzLmhzbCBoYXNoXG4gIGggPSBoc2wuaFxuICBzID0gaHNsLnMgKiAxMDBcbiAgbCA9IGhzbC5sICogMTAwXG4gIGRyYXcoKVxuICBsb2NrID0gb25cbmVsc2VcbiAgZHJhdygpIl19
 //# sourceURL=coffeescript